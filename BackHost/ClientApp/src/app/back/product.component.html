

<ng-template #form let-item="item">


  <nz-tabset [nzAnimated]="false">
    <nz-tab nzTitle="محتوای اصلی">
      <ng-container *ngTemplateOutlet="mainTemplate?.defaultIdStatusTitleForm;context:{item:item}"></ng-container>

      <form nz-form [formGroup]="item">
        <div nz-row>


          <nz-form-label [nzXs]="24" [nzSm]="6" [nzMd]="3">  دسته بندی والد</nz-form-label>
          <div nz-col [nzXs]="24" [nzSm]="18" [nzMd]="9">
            <nz-form-item>
              <nz-form-control>
                <nz-tree-select [nzNodes]="listCache.categoriesAsTree"
                                nzShowSearch
                                nzPlaceHolder="لطفا دسته بندی والد را انتخاب نمایید"
                                formControlName="CategoryId">
                </nz-tree-select>
              </nz-form-control>
            </nz-form-item>
          </div>


          <nz-form-label [nzXs]="24" [nzSm]="6" [nzMd]="3">  توضیحات مختصر</nz-form-label>
          <div nz-col [nzXs]="24" [nzSm]="18" [nzMd]="9">
            <nz-form-item>
              <nz-form-control>
                <textarea nz-input formControlName="Summary" placeholder=" توضیحات مختصر" [nzAutosize]="{ minRows: 3, maxRows: 5 }"></textarea>
              </nz-form-control>
            </nz-form-item>
          </div>

          <nz-form-label [nzXs]="24" [nzSm]="6" [nzMd]="3">  توضیحات  </nz-form-label>
          <div nz-col [nzXs]="24" [nzSm]="18" [nzMd]="21">
            <nz-form-item>
              <nz-form-control>
                <textarea nz-input formControlName="Description" placeholder=" توضیحات  " [nzAutosize]="{ minRows: 6, maxRows: 10 }"></textarea>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>
      </form>
    </nz-tab>


    <nz-tab nzTitle="انواع محصولات ({{item.controls['Types'].value?.length}})">



      <form nz-form [formGroup]="item">
        <app-drag-and-drop-list formControlName="Types"
                                [deleteEnabled]="true"
                                [header]="header"
                                [body]="body">

          <ng-template #header>
            <th>ردیف</th>
            <th> نام/توضیحات  </th>
            <th>
              رنگ/اندازه/مدل
            </th>
            <th>
              تعداد موجود/
              تعداد فروخته شده/
              ماکزیمم تعداد قابل خرید در هر سفارش
            </th>
            <th>
              قیمت برای هر عدد/
              تخفیف برای هر عدد
            </th>
          </ng-template>
          <ng-template #body let-c="item" let-index="index">
            <td>{{index + 1}}</td>

            <td>
              <input [(ngModel)]="c.Title" nz-input (change)="makeItDirty(item)" placeholder="نام" [ngModelOptions]="{standalone: true}" />
              <input [(ngModel)]="c.Description" nz-input (change)="makeItDirty(item)" placeholder="توضیحات" [ngModelOptions]="{standalone: true}" />
            </td>
            <td>

              <nz-select [(ngModel)]="c.ColorId" nzAllowClear nzPlaceHolder="رنگ" [ngModelOptions]="{standalone: true}">
                <nz-option *ngFor="let i of listCache.colors" [nzValue]="i.Id" [nzLabel]="i.Title"></nz-option>
              </nz-select>

              <nz-select [(ngModel)]="c.SizeId" nzAllowClear nzPlaceHolder="اندازه" [ngModelOptions]="{standalone: true}">
                <nz-option *ngFor="let i of listCache.sizes" [nzValue]="i.Id" [nzLabel]="i.Title"></nz-option>
              </nz-select>

              <nz-select [(ngModel)]="c.ModelId" nzAllowClear nzPlaceHolder="مدل" [ngModelOptions]="{standalone: true}">
                <nz-option *ngFor="let i of listCache.models" [nzValue]="i.Id" [nzLabel]="i.Title"></nz-option>
              </nz-select>

            </td>
            <td>
              <nz-input-number [(ngModel)]="c.SupplyCount" [nzMin]="0" (change)="makeItDirty(item)" [ngModelOptions]="{standalone: true}"></nz-input-number>
              <nz-input-number [(ngModel)]="c.SoldCount" [nzMin]="0" (change)="makeItDirty(item)" [ngModelOptions]="{standalone: true}"></nz-input-number>
              <nz-input-number [(ngModel)]="c.MaxAllowedBuy" [nzMin]="0" (change)="makeItDirty(item)" [ngModelOptions]="{standalone: true}"></nz-input-number>
            </td>
            <td>
              <nz-input-number [(ngModel)]="c.Price" [nzMin]="1" (change)="makeItDirty(item)" [ngModelOptions]="{standalone: true}"></nz-input-number>
              <nz-input-number [(ngModel)]="c.Off" [nzMin]="0" (change)="makeItDirty(item)" [ngModelOptions]="{standalone: true}"></nz-input-number>
            </td>
          </ng-template>
        </app-drag-and-drop-list>
      </form>
    </nz-tab>
    <nz-tab *ngIf="item.controls['Id'].value>0" nzTitle="تصاویر  ({{item.controls['Images'].value?.length}})">

      <button nz-button (click)="docId = item.controls['Id'].value;imageModal = true;">
        <i nz-icon
           [innerHtml]="icons['plus-thick']"></i>
      </button>
      <form nz-form [formGroup]="item">

        <app-drag-and-drop-list formControlName="Images"
                                [header]="header2"
                                [addEnabled]="false"
                                [body]="body2">
          <ng-template #header2>
            <th>ردیف</th>
            <th> نام </th> 
            <th>فایل</th>
          </ng-template>
          <ng-template #body2 let-subitem="item" let-index="index">
            <td>{{index + 1}}</td>
            <td style="font-weight:bold">
              <input type="text" nz-input [ngModelOptions]="{standalone: true}" [(ngModel)]="subitem.Description" />
            </td>
            <td>
              <img [src]="'front/'+subitem.Path" style="width:100px"/>
              <button nz-button>
                <i nz-icon
                   [innerHtml]="icons['download']"></i>
              </button>
            </td>
          </ng-template>
        </app-drag-and-drop-list>
      </form>
    </nz-tab>
  </nz-tabset>







</ng-template>

<ng-template #viewMessage>
  آیدی: 012331323
</ng-template>
<ng-template #search>





</ng-template>


<ng-template #tableBody let-item="item">
  <td>{{ item.Id }}</td>
  <td>{{ item.Title }}</td>
  <td>{{ item.Create_}}</td>
  <td>{{ item.CategoryTitle}}</td>
  <ng-container *ngTemplateOutlet="mainTemplate?.statusView;context:{value:statusView(item.Status)}"></ng-container>
</ng-template>




<app-template #mainTemplate *ngIf="ok" [com]="this"></app-template>

<ng-container *ngIf="mainTemplate">

  <nz-modal [(nzVisible)]="imageModal" [nzFooter]="mainTemplate.modalEmptyFooter" nzTitle="افزودن تصویر" (nzOnCancel)="imageModal = false">
    <ng-container *nzModalContent>
      <app-image-uploader-card [key]="dataManager.key" [Id]="docId" (onOk)="addDoc($event)"></app-image-uploader-card>
    </ng-container>
  </nz-modal>
</ng-container>
